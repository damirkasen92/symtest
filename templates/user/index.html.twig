{% extends 'base.html.twig' %}

{% block body %}

	<div class="index-wrapper">
		<h1 class="mb-4">List of users</h1>

		{% include 'includes/alert.html.twig' %}

		<div class="index-sheet">

			<div class="d-flex justify-content-between align-items-center p-2 bg-dark">
				<div class="m-1">
					<!-- Block -->
					<button class="btn btn-outline-warning me-2" 
						data-button-action="block"
						data-bs-toggle="tooltip" 
						data-bs-placement="top" 
        				title="Блокировать пользователя"
					>
						<i class="bi bi-slash-circle"></i>
						Block
					</button>

					<!-- Unblock -->
					<button class="btn btn-outline-success me-2" 
						data-button-action="unblock"
						data-bs-toggle="tooltip" 
						data-bs-placement="top" 
        				title="Разблокировать пользователя"
					>
						<i class="bi bi-check-circle"></i>
					</button>

					<!-- Delete -->
					<button class="btn btn-outline-danger me-2" 
						data-button-action="delete"
						data-bs-toggle="tooltip" 
						data-bs-placement="top" 
        				title="Удалить пользователя"
					>
						<i class="bi bi-trash"></i>
					</button>

					<!-- Delete unverified -->
					<button class="btn btn-outline-danger" 
						data-button-action="delete-unverified"
						data-bs-toggle="tooltip" 
						data-bs-placement="top" 
        				title="Удалить unverified пользователя"
					>
						<i class="bi bi-trash-fill"></i>
					</button>
				</div>
			</div>
			
			<div class="table-responsive">
				<table class="table table-striped table-hover table-bordered">
					<thead class="table-dark">
						<tr>
							<th>
								<label>
									<input type="checkbox" id="selectAll">
								</label>
							</th>
							<th>
								{% include '_sort_link.html.twig' with {
									label: 'Name',
									field: 'name',
									current: app.request.query.get('name')
								} %}
							</th>
							<th>
								{% include '_sort_link.html.twig' with {
									label: 'Email',
									field: 'email',
									current: app.request.query.get('email')
								} %}
							</th>
							<th>
								{% include '_sort_link.html.twig' with {
									label: 'Status',
									field: 'status',
									current: app.request.query.get('status')
								} %}
							</th>
							<th>
								{% include '_sort_link.html.twig' with {
									label: 'Last Login',
									field: 'last_activity_date',
									current: app.request.query.get('last_activity_date')
								} %}
							</th>
						</tr>
					</thead>
					<tbody>
						{% for user in users %}
							<tr>
								<td>
									<input type="checkbox" name="user_id" value="{{ user.id }}" data-is-unverified="{{ user.status.value == 'unverified' ? '1' : '0' }}">
								</td>
								<td>{{ user.name }}</td>
								<td>{{ user.email }}</td>
								<td>{{ user.status.value }}</td>
								{% set lastActivity = user.activities|first %}
								<td>
									{% if lastActivity is not empty %}
										{{ lastActivity.lastActivityDate|date('d.m.Y H:i:s') }}
									{% endif %}
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>

	</div>
{% endblock %}
